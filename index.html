<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Absurdity Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        h1 {
            font-size: 2em;
            color: black;
            margin-bottom: 30px;
            text-align: center;
            font-weight: normal;
            max-width: 800px;
        }

        a {
            color: black;
            text-decoration: underline;
            cursor: pointer;
            font-size: 1em;
        }

        a:hover {
            text-decoration: none;
        }
    </style>
</head>
<body>
    <h1 id="sentence"></h1>
    <a onclick="generateNew()">regenerate</a>

    <script>
        const LEGAL_INSTRUMENTS = [
            'contract',            
        ];

        const ADJECTIVES = [
            'reasonable',
            'ethical',
            'happy',
            'democratic',
            'functional',
            'chivalric',
            'aligned',
            'healthy',
            'cute',
            'clean',
            'tasty'
        ];

        const ENTITIES = [
            'person',
            'corporation',
            'family',
            'sovereign State',
            'united nations',
            'sovereign military order of malta',
            'european union',
            'river',
            'whanganui river',
            'animal',
            'national park',
            'rice'
        ];

        const ACTIONS = [           
            'advise against signing',            
        ];

        function generateSentence(indices) {
            const instrument = LEGAL_INSTRUMENTS[indices[0]];
            const adjective = ADJECTIVES[indices[1]];
            const entity = ENTITIES[indices[2]];
            const action = ACTIONS[indices[3]];

            const article = ['a', 'e', 'i', 'o', 'u'].includes(adjective[0].toLowerCase()) ? 'an' : 'a';
            
            return `A ${instrument} is void if ${article} ${adjective} ${entity} would ${action} it`;
        }

        function generateId(indices) {
            return indices.join('-');
        }

        function parseId(id) {
            return id.split('-').map(Number);
        }

        function getRandomIndices() {
            return [
                Math.floor(Math.random() * LEGAL_INSTRUMENTS.length),
                Math.floor(Math.random() * ADJECTIVES.length),
                Math.floor(Math.random() * ENTITIES.length),
                Math.floor(Math.random() * ACTIONS.length)
            ];
        }

        function displaySentence(indices, _updateHistory ) {
            const updateHistory = (typeof _updateHistory !== 'undefined') ? _updateHistory : true;
            const sentence = generateSentence(indices);
            const id = generateId(indices);
            
            document.getElementById('sentence').textContent = sentence;
            
            if(updateHistory){
                // Update URL without reload
                const newUrl = `${window.location.pathname}?id=${id}`;
                window.history.pushState({id: id}, '', newUrl);
            }
        }

        function generateNew() {
            const indices = getRandomIndices();
            displaySentence(indices);
        }

        function loadFromUrl( updateHistory  ){            
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            
            let indices;
            if (id) {
                indices = parseId(id);
                // Validate indices
                if (indices.length !== 4 || 
                    indices[0] >= LEGAL_INSTRUMENTS.length ||
                    indices[1] >= ADJECTIVES.length ||
                    indices[2] >= ENTITIES.length ||
                    indices[3] >= ACTIONS.length) {
                    indices = getRandomIndices();
                }
            } else {
                indices = getRandomIndices();
            }
            
            displaySentence(indices, updateHistory);
        }

        // Listen for back/forward button
        window.addEventListener('popstate', (event) => {
            loadFromUrl( false );
        });

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadFromUrl();
        });
    </script>
</body>
</html>